<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Rutgers MS CS Pursuit</title>
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background-color: #202020; color: white; }
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        #hud { position: absolute; top: 20px; left: 20px; font-size: 16px; background: rgba(0,0,0,0.7); padding: 15px; border-radius: 8px; border: 2px solid #cc0033; display: none; }
        #hud h2 { margin: 0 0 10px 0; color: #cc0033; text-shadow: 1px 1px 0 #fff; }
        .stat-row { display: flex; justify-content: space-between; min-width: 250px; margin-bottom: 5px; }
        .valid { color: #4caf50; font-weight: bold; }
        .invalid { color: #f44336; }
        
        #start-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(10,10,10,0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; pointer-events: auto; z-index: 10; }
        #start-screen h1 { color: #cc0033; font-size: 48px; text-transform: uppercase; letter-spacing: 2px; margin-bottom: 10px; }
        #start-screen p { font-size: 18px; max-width: 600px; text-align: center; color: #ddd; margin-bottom: 30px; }
        
        .track-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 30px; }
        .track-btn { background: #333; border: 2px solid #555; color: white; padding: 15px; cursor: pointer; border-radius: 5px; font-size: 14px; transition: all 0.2s; text-align: center; }
        .track-btn:hover { border-color: #cc0033; background: #404040; transform: translateY(-2px); }
        .track-btn.selected { background: #cc0033; border-color: #fff; font-weight: bold; }

        #start-btn { background: #cc0033; color: white; border: none; padding: 15px 40px; font-size: 24px; cursor: pointer; border-radius: 50px; font-weight: bold; text-transform: uppercase; box-shadow: 0 0 20px rgba(204,0,51,0.4); }
        #start-btn:hover { background: #e6003a; transform: scale(1.05); }

        #message-area { position: absolute; bottom: 100px; width: 100%; text-align: center; font-size: 24px; font-weight: bold; text-shadow: 2px 2px 4px #000; pointer-events: none; transition: opacity 0.5s; opacity: 0; }
        
        #win-screen { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); flex-direction: column; align-items: center; justify-content: center; z-index: 20; pointer-events: auto; }
        #win-screen h1 { color: #4caf50; font-size: 60px; margin-bottom: 20px; }
        #win-screen p { font-size: 24px; margin-bottom: 30px; }
        #restart-btn { background: #4caf50; color: white; border: none; padding: 15px 30px; font-size: 20px; cursor: pointer; border-radius: 5px; }

        /* Rutgers Red: #cc0033 */
        /* Progress bar styles */
        .progress-row { display:flex; align-items:center; gap:10px; margin-top:6px; }
        .progress-label { width:90px; font-size:13px; color:#ddd; }
        .progress-bar { flex:1; height:14px; background:rgba(255,255,255,0.08); border-radius:8px; overflow:hidden; border:1px solid rgba(0,0,0,0.3); }
        .progress-fill { height:100%; width:0%; background:linear-gradient(90deg,#4caf50,#2196f3); transition:width 300ms ease; }
        .money-fill { background: linear-gradient(90deg,#fdd835,#ff9800); }
        .percent-text { width:50px; text-align:right; font-size:13px; color:#fff; }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div id="start-screen">
            <h1>Rutgers MS Pursuit</h1>
            <p>Welcome, Graduate Student. Your goal is to obtain your M.S. degree.<br>
            Collect <strong>36 Credits</strong> (12 Courses) while fulfilling the requirements for your chosen track.</p>
            
            <div class="track-grid">
                <div class="track-btn selected" data-track="general">General CS</div>
                <div class="track-btn" data-track="aiml">AI / Machine Learning</div>
                <div class="track-btn" data-track="data">Massive Data Analytics</div>
                <div class="track-btn" data-track="robotics">Robotics</div>
                <div class="track-btn" data-track="syssec">Systems & Security</div>
                <div class="track-btn" data-track="vision">Vision & Graphics</div>
            </div>

            <button id="start-btn">Begin Semester</button>
        </div>

        <div id="hud">
            <h2>Current Standing</h2>
            <div class="stat-row"><span>Credits:</span> <span id="credit-count">0 / 36</span></div>
            <div class="stat-row"><span>Money:</span> <span id="money-count">$40,000</span></div>
            <div class="progress-row">
                <div class="progress-label">Money</div>
                <div class="progress-bar"><div id="money-bar-fill" class="progress-fill money-fill"></div></div>
                <div id="money-percent-text" class="percent-text">100%</div>
            </div>
            <div class="progress-row">
                <div class="progress-label">Graduate</div>
                <div class="progress-bar"><div id="grad-bar-fill" class="progress-fill"></div></div>
                <div id="grad-percent-text" class="percent-text">0%</div>
            </div>
            <div class="stat-row"><span>Category A:</span> <span id="cat-a-count">0 / 2</span></div>
            <div class="stat-row"><span>Category B:</span> <span id="cat-b-count">0 / 2</span></div>
            <div class="stat-row"><span>Track Core:</span> <span id="track-core-count">0 / 6</span></div>
            <div class="stat-row" style="margin-top:10px; font-size:14px; color:#aaa;">Last Action: <span id="last-action">-</span></div>
        </div>

        <div id="message-area">Course Collected!</div>

        <div id="win-screen">
            <h1>DEGREE EARNED!</h1>
            <p>Congratulations! You have satisfied all requirements.</p>
            <button id="restart-btn" onclick="location.reload()">Start New Degree</button>
        </div>

        <div id="game-over-screen" style="display:none; position: absolute; top: 0; left: 0; width:100%; height:100%; background: rgba(0,0,0,0.85); z-index:30; flex-direction: column; align-items: center; justify-content: center;">
            <h1 style="color:#f44336; font-size:60px; margin-bottom:20px;">GAME OVER</h1>
            <p style="font-size:24px; color:#ddd; margin-bottom:30px;">You've run out of money and cannot enroll in more courses.</p>
            <button onclick="location.reload()" style="background:#f44336; color:white; border:none; padding:12px 24px; font-size:18px; border-radius:6px;">Restart</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        // --- DATA & CONFIG ---
        const TRACKS = {
            "general": {
                name: "General CS",
                core: ["501", "512", "513", "507", "518", "519", "515", "520", "530", "527", "539"] // Flexible buckets
            },
            "aiml": {
                name: "AI / Machine Learning",
                core: ["581", "501", "512", "513", "543", "550", "520", "530", "535", "536"]
            },
            "data": {
                name: "Massive Data Analytics",
                core: ["501", "512", "513", "527", "539", "543", "550", "526"]
            },
            "robotics": {
                name: "Robotics",
                core: ["501", "560", "512", "513", "520", "530", "534"]
            },
            "syssec": {
                name: "Systems & Security",
                core: ["507", "518", "512", "513", "519", "552", "520", "530"]
            },
            "vision": {
                name: "Vision & Graphics",
                core: ["581", "501", "512", "513", "518", "527", "539", "520", "530", "526"]
            }
        };

        // Course Database (Simplified for Game)
        // Cat A: Math/Algo, Cat B: Systems/Apps
        const COURSES = [
            // Category A
            { id: "501", name: "Math Fnd", cat: "A" },
            { id: "512", name: "Algo", cat: "A" },
            { id: "513", name: "Adv Algo", cat: "A" },
            { id: "581", name: "Stats", cat: "A" },
            { id: "509", name: "Complexity", cat: "A" },
            // Category B
            { id: "507", name: "Comp Arch", cat: "B" },
            { id: "518", name: "OS Design", cat: "B" },
            { id: "519", name: "OS Theory", cat: "B" },
            { id: "515", name: "Prog Lang", cat: "B" },
            { id: "520", name: "AI I", cat: "B" },
            { id: "530", name: "AI II", cat: "B" },
            { id: "527", name: "DB Sys", cat: "B" },
            { id: "539", name: "DB Theory", cat: "B" },
            { id: "535", name: "Pattern Rec", cat: "B" },
            { id: "536", name: "Mach Learn", cat: "B" },
            { id: "560", name: "Robotics", cat: "B" },
            { id: "552", name: "Networks", cat: "B" },
            { id: "543", name: "MDS", cat: "B" },
            { id: "550", name: "MDM", cat: "B" },
            { id: "526", name: "DIVA", cat: "B" },
            { id: "534", name: "Vision", cat: "B" },
            // Electives (Generic)
            { id: "601", name: "Ind. Study", cat: "E" },
            { id: "671", name: "Seminar", cat: "E" }
        ];

        let selectedTrack = "general";
        const STARTING_MONEY = 40000;
        let state = {
            credits: 0,
            money: STARTING_MONEY,
            catA: 0,
            catB: 0,
            trackCore: 0,
            collected: []
        };

        // Game constants
        const COURSE_COST = 3000;
        state.gameOver = false;

        // --- THREE.JS SETUP ---
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87CEEB); // Sky blue
        scene.fog = new THREE.Fog(0x87CEEB, 10, 50);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 5, 10);
        camera.lookAt(0, 0, 0);

        const renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        // Lighting
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);
        const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
        dirLight.position.set(10, 20, 10);
        dirLight.castShadow = true;
        scene.add(dirLight);

        // Ground (The Campus)
        const groundGeo = new THREE.PlaneGeometry(200, 200);
        const groundMat = new THREE.MeshStandardMaterial({ color: 0x228b22 });
        const ground = new THREE.Mesh(groundGeo, groundMat);
        ground.rotation.x = -Math.PI / 2;
        ground.receiveShadow = true;
        scene.add(ground);

        // Grid Helper
        const grid = new THREE.GridHelper(200, 50, 0x000000, 0x000000);
        grid.material.opacity = 0.2;
        grid.material.transparent = true;
        scene.add(grid);

        // Player (The Student)
        const playerGeo = new THREE.BoxGeometry(1, 2, 1);
        const playerMat = new THREE.MeshStandardMaterial({ color: 0xcc0033 }); // Rutgers Red
        const player = new THREE.Mesh(playerGeo, playerMat);
        player.position.y = 1;
        player.castShadow = true;
        scene.add(player);

        // Add an 'R' logo on the player's chest using a canvas texture
        (function addPlayerR() {
            const rCanvas = document.createElement('canvas');
            rCanvas.width = 256; rCanvas.height = 256;
            const rCtx = rCanvas.getContext('2d');
            rCtx.clearRect(0, 0, rCanvas.width, rCanvas.height);

            // Draw white 'R' on transparent background so cube red shows behind it
            rCtx.fillStyle = 'white';
            // Big bold font for visibility
            rCtx.font = 'bold 180px Arial';
            rCtx.textAlign = 'center';
            rCtx.textBaseline = 'middle';
            rCtx.fillText('R', rCanvas.width / 2, rCanvas.height / 2 + 6);

            const rTex = new THREE.CanvasTexture(rCanvas);
            const rMat = new THREE.MeshBasicMaterial({ map: rTex, transparent: true, side: THREE.DoubleSide });
            const rGeo = new THREE.PlaneGeometry(0.9, 1.2);

            // Front chest label
            const rLabel = new THREE.Mesh(rGeo, rMat);
            rLabel.position.set(0, 1, 0.51);
            rLabel.renderOrder = 999;
            player.add(rLabel);

            // Back label so 'R' shows from behind as well
            const rLabelBack = rLabel.clone();
            rLabelBack.rotation.y = Math.PI;
            rLabelBack.position.set(0, 1, -0.51);
            player.add(rLabelBack);
        })();

        // Collectibles Group
        const collectibles = [];
        
        function spawnCourse(x, z) {
            // Pick random course
            const courseData = COURSES[Math.floor(Math.random() * COURSES.length)];
            
            // Geometry
            const geo = new THREE.BoxGeometry(1.5, 1.5, 1.5);
            
            // Material - Color code by Category
            let color = 0xffff00; // Elective/Other (Yellow)
            if (courseData.cat === 'A') color = 0x4caf50; // Green
            if (courseData.cat === 'B') color = 0x2196f3; // Blue
            
            // Check if it's a core requirement for current track (Make it glow/distinct)
            const isCore = TRACKS[selectedTrack].core.includes(courseData.id);
            if (isCore) {
                // Gold tint if it's a core requirement we need
            }

            const mat = new THREE.MeshStandardMaterial({ color: color, opacity: 0.9, transparent: true });
            const mesh = new THREE.Mesh(geo, mat);
            
            mesh.position.set(x, 1.5, z);
            mesh.userData = { ...courseData, isCore: isCore };
            
            // Add floating animation data
            mesh.userData.floatOffset = Math.random() * Math.PI * 2;
            
            // Simple text label (using canvas texture for course name)
            const canvas = document.createElement('canvas');
            // Larger canvas for crisper, bigger text
            canvas.width = 512; canvas.height = 256;
            const ctx = canvas.getContext('2d');
            // Rutgers red background with white text for strong contrast
            ctx.fillStyle = '#cc0033';
            ctx.fillRect(0,0,canvas.width,canvas.height);
            ctx.fillStyle = 'white';
            // Bigger font so the course number is prominent
            ctx.font = 'bold 140px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(courseData.id, canvas.width/2, canvas.height/2);

            const tex = new THREE.CanvasTexture(canvas);
            const labelGeo = new THREE.PlaneGeometry(1.8, 1.0);
            const labelMat = new THREE.MeshBasicMaterial({ map: tex, transparent: true, side: THREE.DoubleSide });

            // Front label
            const labelFront = new THREE.Mesh(labelGeo, labelMat);
            labelFront.position.z = 0.76;
            mesh.add(labelFront);

            // Back label (rotated)
            const labelBack = new THREE.Mesh(labelGeo, labelMat);
            labelBack.rotation.y = Math.PI;
            labelBack.position.z = -0.76;
            mesh.add(labelBack);

            // Right label
            const labelRight = new THREE.Mesh(labelGeo, labelMat);
            labelRight.rotation.y = -Math.PI/2;
            labelRight.position.x = 0.76;
            mesh.add(labelRight);

            // Left label
            const labelLeft = new THREE.Mesh(labelGeo, labelMat);
            labelLeft.rotation.y = Math.PI/2;
            labelLeft.position.x = -0.76;
            mesh.add(labelLeft);

            scene.add(mesh);
            collectibles.push(mesh);
        }

        // Spawn initial courses
        for(let i=0; i<30; i++) {
            spawnCourse((Math.random()-0.5)*80, (Math.random()-0.5)*80);
        }

        // --- GAMEPLAY LOGIC ---
        const keys = { w:false, a:false, s:false, d:false, ArrowUp:false, ArrowLeft:false, ArrowDown:false, ArrowRight:false, " ":false };
        
        window.addEventListener('keydown', (e) => { keys[e.key] = true; });
        window.addEventListener('keyup', (e) => { keys[e.key] = false; });

        // Menu Logic
        const trackBtns = document.querySelectorAll('.track-btn');
        trackBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                trackBtns.forEach(b => b.classList.remove('selected'));
                btn.classList.add('selected');
                selectedTrack = btn.getAttribute('data-track');
            });
        });

        document.getElementById('start-btn').addEventListener('click', () => {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('hud').style.display = 'block';
            updateHUD();
            animate();
        });

        function showMessage(text, isGood) {
            const el = document.getElementById('message-area');
            el.innerText = text;
            el.style.color = isGood ? '#4caf50' : '#f44336';
            el.style.opacity = 1;
            setTimeout(() => { el.style.opacity = 0; }, 2000);
        }

        function updateHUD() {
            document.getElementById('credit-count').innerText = `${state.credits} / 36`;
            // Format money with commas
            const moneyEl = document.getElementById('money-count');
            if (moneyEl) {
                moneyEl.innerText = `$${state.money.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",")}`;
                moneyEl.className = state.money <= 0 ? 'invalid' : '';
            }

            // Update percent bars
            const moneyPercent = Math.max(0, Math.round((state.money / (STARTING_MONEY || 1)) * 100));
            const moneyFill = document.getElementById('money-bar-fill');
            const moneyPctText = document.getElementById('money-percent-text');
            if (moneyFill) moneyFill.style.width = `${moneyPercent}%`;
            if (moneyPctText) moneyPctText.innerText = `${moneyPercent}%`;

            const gradPercent = Math.min(100, Math.round((state.credits / 36) * 100));
            const gradFill = document.getElementById('grad-bar-fill');
            const gradPctText = document.getElementById('grad-percent-text');
            if (gradFill) gradFill.style.width = `${gradPercent}%`;
            if (gradPctText) gradPctText.innerText = `${gradPercent}%`;
            
            const catAEl = document.getElementById('cat-a-count');
            catAEl.innerText = `${state.catA} / 2`;
            catAEl.className = state.catA >= 2 ? 'valid' : '';

            const catBEl = document.getElementById('cat-b-count');
            catBEl.innerText = `${state.catB} / 2`;
            catBEl.className = state.catB >= 2 ? 'valid' : '';

            const coreEl = document.getElementById('track-core-count');
            coreEl.innerText = `${state.trackCore} / 6`;
            // Note: Rutgers allows choices for the 6, so we just track quantity of valid core courses picked
            coreEl.className = state.trackCore >= 6 ? 'valid' : '';

            // Win Condition Check
            if (state.credits >= 36 && state.catA >= 2 && state.catB >= 2 && state.trackCore >= 6) {
                document.getElementById('win-screen').style.display = 'flex';
                // Stop loop handled by logic
            }
        }

        function collectCourse(mesh, index) {
            if (state.gameOver) return;
            // Check funds first
            if (state.money < COURSE_COST) {
                showMessage(`Not enough money to enroll!`, false);
                triggerGameOver();
                return;
            }
            const data = mesh.userData;
            
            // Logic: Cannot retake course
            if (state.collected.includes(data.id)) {
                showMessage(`Already took CS ${data.id}!`, false);
                return; // Don't remove, just bounce or ignore
            }

            state.collected.push(data.id);
            // Charge for the course
            state.money -= COURSE_COST;
            if (state.money < 0) state.money = 0;
            state.credits += 3;
            
            if (data.cat === 'A') state.catA++;
            if (data.cat === 'B') state.catB++;
            
            // Track Requirement Check
            const trackReqs = TRACKS[selectedTrack].core;
            if (trackReqs.includes(data.id)) {
                state.trackCore++;
                showMessage(`Picked up CS ${data.id} (Core)!`, true);
            } else {
                showMessage(`Picked up CS ${data.id} (Elective)`, true);
            }

            document.getElementById('last-action').innerText = `Added CS ${data.id} (${data.name})`;

            // Remove from scene
            scene.remove(mesh);
            collectibles.splice(index, 1);
            
            // Spawn a new one to keep field populated
            spawnCourse((Math.random()-0.5)*80, (Math.random()-0.5)*80);

            updateHUD();

            // If money ran out exactly after purchase, game over
            if (state.money <= 0) {
                showMessage('You have no money left!', false);
                triggerGameOver();
            }
        }

        function triggerGameOver() {
            if (state.gameOver) return;
            state.gameOver = true;
            const el = document.getElementById('game-over-screen');
            if (el) el.style.display = 'flex';
        }

        // --- ANIMATION LOOP ---
        let playerVelY = 0;
        const speed = 0.3;
        
        function animate() {
            requestAnimationFrame(animate);

            // If game over, freeze game (no input or pickups)
            if (state.gameOver) {
                renderer.render(scene, camera);
                return;
            }

            // Player Movement
            if (keys['w'] || keys['ArrowUp']) player.position.z -= speed;
            if (keys['s'] || keys['ArrowDown']) player.position.z += speed;
            if (keys['a'] || keys['ArrowLeft']) player.position.x -= speed;
            if (keys['d'] || keys['ArrowRight']) player.position.x += speed;

            // Jumping
            if (keys[' '] && player.position.y <= 1) {
                playerVelY = 0.3;
            }
            
            player.position.y += playerVelY;
            playerVelY -= 0.015; // Gravity
            if (player.position.y < 1) {
                player.position.y = 1;
                playerVelY = 0;
            }

            // Camera Follow
            camera.position.x = player.position.x;
            camera.position.z = player.position.z + 15;
            camera.lookAt(player.position);

            // Animate Collectibles & Collision Detection
            const playerBox = new THREE.Box3().setFromObject(player);
            
            for (let i = collectibles.length - 1; i >= 0; i--) {
                const mesh = collectibles[i];
                mesh.rotation.y += 0.02;
                mesh.position.y = 1.5 + Math.sin(Date.now() * 0.003 + mesh.userData.floatOffset) * 0.3;
                
                const box = new THREE.Box3().setFromObject(mesh);
                if (playerBox.intersectsBox(box)) {
                    collectCourse(mesh, i);
                }
            }

            renderer.render(scene, camera);
        }

        // Handle Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>